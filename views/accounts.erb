<% content_for :header do %>
  <h1> Accounts </h1>
<% end %>

<style>
  .nav-list a.active { background: blue; color: white;}
  .nav-list a.active:hover { background: blue; color: white;}
.tab-pane {
  display: none;
}

.tab-pane.active {
  display: block;
}

</style>

<script type="text/x-handlebars" id="loading">
  <div class="fullscreen-overlay"></div>
</script>

<script type="text/x-handlebars" >
  {{outlet modal}}
  {{outlet loading}}
  <div class="row">
   
    <div class="span3">

      <ul class="nav nav-list">
        <li>
        {{#linkTo "index" }} 
        <img {{bindAttr src=model.user.gravatar_url  }} /> 
        {{ model.user.login }}
        {{/linkTo}}
        </li>

        {{#each model.orgs}}
        <li>
        {{#linkTo "profile" this}} 
        <img {{bindAttr src=gravatar_url  }} /> 
          {{ login }} 
        {{/linkTo}}
        </li>
        {{/each}}
      </ul>
    </div> 
    <div class="span9">
      {{ outlet }}
    </div> 
  </div> 


</script>

<script type="text/x-handlebars" id="index">
  <div class="nav-section">

    <div class="widget-header">
      <h3> {{ model.login }} </h3>
    </div>
    <div class="widget-body">
      <p> {{ model.details.herp }} </p>
    </div>
  </div>
</script>

<script type="text/x-handlebars" id="account">
  <table class="table">
    <thead>
      <th>Plan</th>
      <th>Price</th>
      <th>Private repositories</th>
      <th></th>
    </head>
    <tbody>
      <tr>
        <td>Organization</td>
        <td>$24/month</td>
        <td>unlimited</td>
        <td>
          {{#if model.details.has_plan }} 
            Your plan
            <button class="hb-button small"
               {{action cancel model.details }}>Cancel plan</button>
          {{else}}
            <button class="hb-button small"
               {{bindAttr disabled="model.details.has_plan" }}
               {{action purchase model.details }}>Upgrade</button>
          {{/if}}
        </td>
      </tr>
      {{#each model.details.plans }}
        <td>{{ name }}</td>
        <td>{{ amount }}</td>
        <td>unlimited</td>
        <td></td>
        
      {{/each}}
    </tbody>
  </table>
</script>   

<script type="text/x-handlebars" data-template-name="purchase_form">
<div class="modal">
  <form {{action purchase on=submit}}>
  <div class="modal-header">
    <button type="button" class="close" {{action close}} data-dismiss="modal" aria-hidden="true">Ã—</button>
    Credit card infomation
  </div>
  <div class="modal-body">
    <fieldset>
      {{#if errors}}
        <div class="alert alert-error">{{errors}}</div>
      {{/if}}

      <div class="form-row">
        <label>
          <span>Card Number</span>
        </label>
        {{view App.CardNumberField valueBinding="number" size=20}}
      </div>

      <div class="form-row">
        <label>
          <span>CVC</span>
        </label>
        {{view App.CvcField valueBinding="cvc" size="4" data-stripe="cvc"}}
      </div>

      <div class="form-row">
        <label>
          <span>Expiration ({{ expMonth }} / {{ expYear }})</span>
        </label>
        {{view App.CardExpiryField valueBinding="exp" }}
      </div>

      <div class="form-row">
        <label>
          <span>Billing email</span>
        </label>
        {{input valueBinding="model.org.billing_email" type=text required=true }}
      </div>

    </fieldset>
  
  </div>
  <div class="modal-footer">
      <button class="hb-button" type="submit" {{bindAttr disabled="processingPurchase"}}> Submit Payment</button>
  </div>
  </form>
  </div>
</script>

<script type="text/x-handlebars" id="profile">

{{#x-tabs}}
    {{#x-pane title="Plans"}}
    <div class="nav-section">
     
      <div class="widget-body">
        {{#if model.details.org.is_owner }}

          {{ render account model }}

        {{else}}
          <div class="alert">
            <h5>You must be an owner to purchase</h5>
            It appears like you are not a member of the owners team for {{ model.login }}. 
            We strongly encourage that only members of the &quot;Owners&quot; team have access to subscription
            information. If you have any questions feel free to email customer support at
            <a href="mailto:huboard@huboard.com">huboard@huboard.com</a>. 
          </div>
        {{/if}}
      </div>
    </div>
    {{/x-pane}}
      {{#x-pane title="Payment history"}}
       Payment history stuff
      {{/x-pane}}
    {{/x-tabs}}

</script>

  <script type="text/x-handlebars" id="components/x-tabs">
  <div class="tabbable">
    <ul class="nav nav-tabs">
      {{#each pane in panes}}
      <li {{bindAttr class="pane.selected:active"}}>
        <a href="#" {{action select pane}}>{{pane.title}}</a>
      </li>
      {{/each}}
    </ul>
    <div class="tab-content">
      {{yield}}
    </div>
  </div>
  </script>
  
  <script type="text/x-handlebars" id="components/x-pane">
    <div class="tab-pane" {{bindAttr class="selected:active"}}>
      {{yield}}
    </div>
  </script>

  <script type="text/x-handlebars" id="empty">

  </script>

